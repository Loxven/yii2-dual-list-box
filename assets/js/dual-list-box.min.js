/**
 * jQuery DualListBox plugin v1.0
 * http://www.geodan.nl
 *
 * Copyright (c) 2014, Geodan B.V. (Alex van den Hoogen)
 * Update for Yii2: Makyutin Dmitriy http://www.maksyutin.ru
 * License: MIT License
 */
(function(e){function t(t,n){var i=false;if(t.text.indexOf(":")>-1){var s=t.text.split(":");if(s.length>1){i=true}}e.getJSON(t.uri,function(o){e.each(o,function(r,o){var u="";if(i){s.forEach(function(e){u+=o[e]+" "})}else{u=o[t.text]}e("<option>",{value:o[t.value],text:u,selected:n.some(function(e){return e[t.value]===o[t.value]})===true}).appendTo(t.element)});r(t)})}function n(t){var n=e(t.parentElement+" .unselected");var r=e(t.parentElement+" .selected");e(t.parentElement).find("button").bind("click",function(){switch(e(this).data("type")){case"str":n.find("option:selected").appendTo(r);e(this).prop("disabled",true);break;case"atr":if(n.find("option").length>=t.maxAllBtn&&confirm(t.warning)||n.find("option").length<t.maxAllBtn){n.find("option").each(function(){if(e(this).isVisible()){e(this).remove().appendTo(r)}})}break;case"stl":r.find("option:selected").remove().appendTo(n);e(this).prop("disabled",true);break;case"atl":if(r.find("option").length>=t.maxAllBtn&&confirm(t.warning)||r.find("option").length<t.maxAllBtn){r.find("option").each(function(){if(e(this).isVisible()){e(this).remove().appendTo(n)}})}break;default:break}n.filterByText(e(t.parentElement+" .filter-unselected"),t.timeout,t.parentElement).scrollTop(0).sortOptions();r.filterByText(e(t.parentElement+" .filter-selected"),t.timeout,t.parentElement).scrollTop(0).sortOptions();a(t)});e(t.parentElement).closest("form").submit(function(){r.find("option").prop("selected",true)});e(t.parentElement).find('input[type="text"]').keypress(function(e){if(e.which===13){event.preventDefault()}});r.filterByText(e(t.parentElement+" .filter-selected"),t.timeout,t.parentElement).scrollTop(0).sortOptions();n.filterByText(e(t.parentElement+" .filter-unselected"),t.timeout,t.parentElement).scrollTop(0).sortOptions()}function r(e){s(e);f(e);n(e)}function i(t,n){var r=0,i=0,s=new Array;e(t+" .unselected").find("option").each(function(){if(e(this).isVisible()){r++}});e(t+" .selected").find("option").each(function(){if(e(this).isVisible()){s[i]=this.value;i++}});var o=JSON.stringify(s);e("#"+n.name+"-"+n.id).val(o);e(t+" .unselected-count").text(r);e(t+" .selected-count").text(i);l(t)}function s(t){e(t.element).parent().attr("id",t.parent);e(t.parentElement).addClass("row").append((t.horizontal==false?'   <div class="col-md-5">':'   <div class="col-md-6">')+'       <h4><span class="unselected-title"></span> <small>- показано <span class="unselected-count"></span></small></h4>'+'       <input class="filter form-control filter-unselected" type="text" placeholder="Поиск" style="margin-bottom: 5px;">'+(t.horizontal==false?"":o(1,t.moveAllBtn))+'       <select class="unselected" style="height: 200px; width: 100%;" multiple></select>'+"   </div>"+(t.horizontal==false?u(t.moveAllBtn):"")+(t.horizontal==false?'   <div class="col-md-5">':'   <div class="col-md-6">')+'       <h4><span class="selected-title"></span> <small>- показано <span class="selected-count"></span></small></h4>'+'       <input class="filter form-control filter-selected" type="text" placeholder="Поиск" style="margin-bottom: 5px;">'+(t.horizontal==false?"":o(2,t.moveAllBtn))+'       <select class="selected" style="height: 200px; width: 100%;" multiple></select>'+"   </div>");var n=e(t.parentElement+" .unselected");var r=e(t.parentElement+" .selected");e(t.parentElement+" .selected").prop("name",e(t.element).prop("name"));e(t.parentElement+" .unselected-title").text("Имеющиеся "+t.title);e(t.parentElement+" .selected-title").text("Выбранные "+t.title)}function o(e,t){if(e==1){return(t?'       <button type="button" class="btn btn-default atr" data-type="atr" style="margin-bottom: 5px;"><span class="glyphicon glyphicon-chevron-right"></span> <span class="glyphicon glyphicon-chevron-right"></span></button>':"")+'       <button type="button" class="btn btn-default '+(t?"pull-right col-md-6":"col-md-12")+' str" data-type="str" style="margin-bottom: 5px;" disabled><span class="glyphicon glyphicon-chevron-right"></span></button>'}else{return'       <button type="button" class="btn btn-default '+(t?"col-md-6":"col-md-12")+' stl" data-type="stl" style="margin-bottom: 5px;" disabled><span class="glyphicon glyphicon-chevron-left"></span></button>'+(t?'       <button type="button" class="btn btn-default col-md-6 pull-right atl" data-type="atl" style="margin-bottom: 5px;"><span class="glyphicon glyphicon-chevron-left"></span> <span class="glyphicon glyphicon-list"></span></button>':"")}}function u(e){return'   <div class="col-md-2 center-block" style="margin-top: '+(e?"80px":"130px")+'">'+(e?'       <button type="button" class="btn btn-default col-md-8 col-md-offset-2 atr" data-type="atr" style="margin-bottom: 10px;"><span class="glyphicon glyphicon-chevron-right"></span> <span style="margin-left: -10px;" class="glyphicon glyphicon-chevron-right"></span></button>':"")+'       <button type="button" class="btn btn-default col-md-8 col-md-offset-2 str" data-type="str" style="margin-bottom: 20px;" disabled><span class="glyphicon glyphicon-chevron-right"></span></button>'+'       <button type="button" class="btn btn-default col-md-8 col-md-offset-2 stl" data-type="stl" style="margin-bottom: 10px;" disabled><span class="glyphicon glyphicon-chevron-left"></span></button>'+(e?'       <button type="button" class="btn btn-default col-md-8 col-md-offset-2 atl" data-type="atl" style="margin-bottom: 10px;"><span class="glyphicon glyphicon-chevron-left"></span> <span style="margin-left: -10px;" class="glyphicon glyphicon-chevron-left"></span></button>':"")+"   </div>"}function a(t){e(t.parentElement+" .unselected").find("option:selected").prop("selected",false);e(t.parentElement+" .selected").find("option:selected").prop("selected",false);e(t.parentElement+" .filter").val("");e(t.parentElement+" select").find("option").each(function(){e(this).show()});i(t.parentElement,t)}function f(t){var n=false;var r=e(t.parentElement+" .unselected");var i=e(t.parentElement+" .selected");e(t.element).find("option").text(function(r,i){e(this).data("title",i);if(i.length>t.textLength){n=true;return i.substr(0,t.textLength)+"..."}}).each(function(){if(n){e(this).prop("title",e(this).data("title"))}if(e(this).is(":selected")){e(this).appendTo(t.parentElement+" .selected")}else{e(this).appendTo(t.parentElement+" .unselected")}});e(t.element).remove();a(t)}function l(t){e(t+" .unselected").change(function(){e(t+" .str").prop("disabled",false)});e(t+" .selected").change(function(){e(t+" .stl").prop("disabled",false)});if(e(t+" .unselected").has("option").length==0){e(t+" .atr").prop("disabled",true);e(t+" .str").prop("disabled",true)}else{e(t+" .atr").prop("disabled",false)}if(e(t+" .selected").has("option").length==0){e(t+" .atl").prop("disabled",true);e(t+" .stl").prop("disabled",true)}else{e(t+" .atl").prop("disabled",false)}}e.fn.DualListBox=function(n,i){return this.each(function(){var s={element:e(this).context,id:e(this).context.id,name:e(this).context.id,uri:"local.json",value:"id",text:"name",title:"Example",json:true,timeout:500,horizontal:false,textLength:45,moveAllBtn:true,maxAllBtn:1e3,warning:"Вы уверены, что хотите выбрать такое количество элементов? Возможно Ваш браузер может перестанет отвечать на запросы.."};var o={element:e(this).context,id:e(this).data("id"),name:e(this).data("name"),uri:e(this).data("source"),value:e(this).data("value"),text:e(this).data("text"),title:e(this).data("title"),json:e(this).data("json"),timeout:e(this).data("timeout"),horizontal:e(this).data("horizontal"),textLength:e(this).data("textLength"),moveAllBtn:e(this).data("moveAllBtn"),maxAllBtn:e(this).data("maxAllBtn")};var u=e.extend({},s,o,n);var a=u["id"].id;e.each(u,function(e,t){if(t===undefined||t===null){throw"DualListBox: "+e+" is undefined."}});u["id"]=a;u["parent"]="dlb-"+a;u["parentElement"]="#"+u.parent;i=e.extend([{}],i);if(u.json){t(u,i)}else{r(u)}})};e.fn.filterByText=function(t,n,r){return this.each(function(){var s=this;var o=[];e(s).find("option").each(function(){o.push({value:e(this).val(),text:e(this).text()})});e(s).data("options",o);e(t).bind("change keyup",function(){c(function(){var n=e(s).data("options");var o=e.trim(e(t).val());var u=new RegExp(o,"gi");e.each(n,function(t){if(n[t].text.match(u)===null){e(s).find(e('option[value="'+n[t].value+'"]')).hide()}else{e(s).find(e('option[value="'+n[t].value+'"]')).show()}});i(r,n)},n)})})};e.fn.isVisible=function(){return!(e(this).css("visibility")=="hidden"||e(this).css("display")=="none")};e.fn.sortOptions=function(){return this.each(function(){e(this).append(e(this).find("option").remove().sort(function(t,n){var r=e(t).text(),i=e(n).text();return r>i?1:r<i?-1:0}))})};var c=function(){var e=0;return function(t,n){clearTimeout(e);e=setTimeout(t,n)}}()})(jQuery)